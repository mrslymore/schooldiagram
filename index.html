<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Floor Plan</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }

    #toolbar {
      padding: 10px;
      background: #eee;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    #floorplan {
      width: 100%;
      height: 90vh;
      border: 1px solid #ccc;
      position: relative;
      overflow: hidden;
    }

    .room {
      position: absolute;
      border: 2px solid #333;
      background-color: #f9f9f9;
      padding: 5px;
      resize: both;
      overflow: auto;
      cursor: move;
      user-select: none;
      min-width: 60px;
      min-height: 40px;
    }

    .room.selected {
      border: 2px dashed red;
    }

    .resizer {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #555;
      right: 0;
      bottom: 0;
      cursor: se-resize;
    }

    /* Modal Styling */
    #roomSettingsModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border: 2px solid #333;
      display: none;
      z-index: 10;
    }

    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 5;
    }

    textarea {
      width: 100%;
      height: 60px;
    }
  </style>
</head>
<body>

<div id="toolbar">
  <button onclick="createRoom()">+ Add Room</button>
  <button onclick="editSelectedRoom()">‚úèÔ∏è Edit</button>
  <button onclick="deleteSelectedRooms()">üóëÔ∏è Delete</button>
</div>

<div id="floorplan"></div>

<!-- Modal for Room Settings -->
<div id="overlay"></div>
<div id="roomSettingsModal">
  <label>Room Name:</label><br>
  <textarea id="roomText"></textarea><br><br>

  <label>Background Color:</label><br>
  <input type="color" id="roomColor"><br><br>

  <label>Font Size:</label><br>
  <input type="number" id="roomFontSize" min="8" max="48" value="16"><br><br>

  <button onclick="applyRoomSettings()">Apply</button>
  <button onclick="closeRoomSettings()">Cancel</button>
</div>

<script>
let selectedRooms = new Set();
let currentRoom = null;

function createRoom() {
  const room = document.createElement("div");
  room.classList.add("room");
  room.style.left = "100px";
  room.style.top = "100px";
  room.style.width = "100px";
  room.style.height = "60px";
  room.style.fontSize = "16px";
  room.textContent = "New Room";

  // Add resizer
  const resizer = document.createElement("div");
  resizer.classList.add("resizer");
  room.appendChild(resizer);

  enableRoomInteraction(room);
  document.getElementById("floorplan").appendChild(room);
}

function enableRoomInteraction(room) {
  room.addEventListener("mousedown", startDrag);
  room.addEventListener("click", toggleRoomSelection);

  const resizer = room.querySelector(".resizer");
  resizer.addEventListener("mousedown", startResize);
}

function toggleRoomSelection(e) {
  if (e.shiftKey) {
    this.classList.toggle("selected");
    if (selectedRooms.has(this)) {
      selectedRooms.delete(this);
    } else {
      selectedRooms.add(this);
    }
  } else {
    selectedRooms.forEach(r => r.classList.remove("selected"));
    selectedRooms.clear();
    this.classList.add("selected");
    selectedRooms.add(this);
  }
  e.stopPropagation();
}

document.getElementById("floorplan").addEventListener("click", () => {
  selectedRooms.forEach(r => r.classList.remove("selected"));
  selectedRooms.clear();
});

function startDrag(e) {
  if (!selectedRooms.has(this)) return;
  e.preventDefault();
  const startX = e.clientX;
  const startY = e.clientY;

  const positions = Array.from(selectedRooms).map(room => {
    return {
      el: room,
      startLeft: parseInt(room.style.left),
      startTop: parseInt(room.style.top)
    };
  });

  function drag(e) {
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    positions.forEach(({el, startLeft, startTop}) => {
      el.style.left = (startLeft + dx) + "px";
      el.style.top = (startTop + dy) + "px";
    });
  }

  function stopDrag() {
    document.removeEventListener("mousemove", drag);
    document.removeEventListener("mouseup", stopDrag);
  }

  document.addEventListener("mousemove", drag);
  document.addEventListener("mouseup", stopDrag);
}

function startResize(e) {
  e.stopPropagation();
  const room = this.parentElement;
  if (!selectedRooms.has(room)) return;

  e.preventDefault();
  const startX = e.clientX;
  const startY = e.clientY;

  const dimensions = Array.from(selectedRooms).map(room => {
    return {
      el: room,
      startWidth: room.offsetWidth,
      startHeight: room.offsetHeight
    };
  });

  function resize(e) {
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    dimensions.forEach(({el, startWidth, startHeight}) => {
      el.style.width = (startWidth + dx) + "px";
      el.style.height = (startHeight + dy) + "px";
    });
  }

  function stopResize() {
    document.removeEventListener("mousemove", resize);
    document.removeEventListener("mouseup", stopResize);
  }

  document.addEventListener("mousemove", resize);
  document.addEventListener("mouseup", stopResize);
}

function editSelectedRoom() {
  if (selectedRooms.size === 0) return;

  currentRoom = Array.from(selectedRooms)[0]; // Use first for form data

  document.getElementById("roomText").value = currentRoom.childNodes[0]?.textContent || "";
  document.getElementById("roomColor").value = rgbToHex(currentRoom.style.backgroundColor);
  document.getElementById("roomFontSize").value = parseInt(currentRoom.style.fontSize) || 16;

  document.getElementById("overlay").style.display = "block";
  document.getElementById("roomSettingsModal").style.display = "block";
}

function applyRoomSettings() {
  const text = document.getElementById("roomText").value;
  const color = document.getElementById("roomColor").value;
  const fontSize = document.getElementById("roomFontSize").value + "px";

  selectedRooms.forEach(room => {
    const resizer = room.querySelector(".resizer");
    room.innerHTML = "";
    const textNode = document.createElement("div");
    textNode.textContent = text;
    textNode.style.whiteSpace = "pre-wrap";
    room.appendChild(textNode);
    room.appendChild(resizer);

    room.style.backgroundColor = color;
    room.style.fontSize = fontSize;
  });

  closeRoomSettings();
}

function closeRoomSettings() {
  document.getElementById("overlay").style.display = "none";
  document.getElementById("roomSettingsModal").style.display = "none";
  currentRoom = null;
}

function deleteSelectedRooms() {
  selectedRooms.forEach(room => room.remove());
  selectedRooms.clear();
}

function rgbToHex(rgb) {
  if (!rgb || rgb.indexOf("rgb") === -1) return "#f9f9f9";
  const result = rgb.match(/\d+/g).map(Number);
  return "#" + result.map(x => x.toString(16).padStart(2, "0")).join("");
}
</script>

</body>
</html>
